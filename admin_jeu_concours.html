<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Administration - Jeu Concours Alliance 2026</title>
    <style>
        :root {
            --violet-principal: #a8217a;
            --violet-clair: #c94ba0;
            --bleu-turquoise: #1a9c9e;
            --gris-fonce: #2d2d2d;
            --blanc: #ffffff;
            --vert: #4caf50;
            --rouge: #f44336;
            --orange: #ff9800;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #f5f5f5 0%, #e8e8e8 100%);
            color: var(--gris-fonce);
            line-height: 1.6;
        }

        /* ===== √âCRAN DE CONNEXION ===== */
        .login-container {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 20px;
        }

        .login-box {
            background: var(--blanc);
            padding: 40px;
            border-radius: 20px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.1);
            max-width: 400px;
            width: 100%;
        }

        .login-box h1 {
            color: var(--violet-principal);
            margin-bottom: 10px;
            text-align: center;
        }

        .login-box .subtitle {
            text-align: center;
            color: #666;
            margin-bottom: 30px;
            font-size: 0.9em;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--gris-fonce);
        }

        .form-group input {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 1em;
            transition: all 0.3s ease;
        }

        .form-group input:focus {
            outline: none;
            border-color: var(--violet-principal);
            box-shadow: 0 0 0 3px rgba(168, 33, 122, 0.1);
        }

        .btn {
            width: 100%;
            padding: 14px;
            border: none;
            border-radius: 8px;
            font-size: 1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--violet-principal), var(--violet-clair));
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(168, 33, 122, 0.4);
        }

        .btn-success {
            background: var(--vert);
            color: white;
        }

        .btn-danger {
            background: var(--rouge);
            color: white;
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
        }

        /* ===== DASHBOARD ===== */
        .admin-container {
            display: none;
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .admin-header {
            background: linear-gradient(135deg, var(--violet-principal), var(--violet-clair));
            color: white;
            padding: 30px;
            border-radius: 15px;
            margin-bottom: 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .admin-header h1 {
            margin: 0;
        }

        .btn-logout {
            background: rgba(255,255,255,0.2);
            color: white;
            padding: 10px 20px;
            border: 2px solid white;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn-logout:hover {
            background: white;
            color: var(--violet-principal);
        }

        /* ===== STATISTIQUES ===== */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            text-align: center;
        }

        .stat-number {
            font-size: 3em;
            font-weight: 700;
            color: var(--violet-principal);
            margin: 10px 0;
        }

        .stat-label {
            color: #666;
            font-size: 0.9em;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        /* ===== ONGLETS ===== */
        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            border-bottom: 2px solid #e0e0e0;
        }

        .tab {
            padding: 15px 25px;
            background: transparent;
            border: none;
            border-bottom: 3px solid transparent;
            cursor: pointer;
            font-weight: 600;
            color: #666;
            transition: all 0.3s ease;
        }

        .tab.active {
            color: var(--violet-principal);
            border-bottom-color: var(--violet-principal);
        }

        .tab:hover {
            color: var(--violet-principal);
        }

        .tab-content {
            display: none;
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        .tab-content.active {
            display: block;
        }

        /* ===== QUESTIONS ===== */
        .question-item {
            background: #f8f9fa;
            padding: 20px;
            margin-bottom: 15px;
            border-radius: 10px;
            border-left: 4px solid var(--violet-principal);
        }

        .question-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .question-number {
            font-weight: 700;
            color: var(--violet-principal);
        }

        .question-actions {
            display: flex;
            gap: 10px;
        }

        .btn-small {
            padding: 6px 12px;
            font-size: 0.85em;
            border-radius: 5px;
            border: none;
            cursor: pointer;
        }

        .answer-option {
            padding: 8px 15px;
            margin: 5px 0;
            background: white;
            border-radius: 5px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .answer-option.correct {
            background: #e8f5e9;
            border-left: 3px solid var(--vert);
        }

        /* ===== FORMULAIRE D'√âDITION ===== */
        .edit-form {
            background: #f8f9fa;
            padding: 25px;
            border-radius: 10px;
            margin-top: 20px;
        }

        .edit-form input,
        .edit-form textarea {
            width: 100%;
            padding: 10px;
            margin: 8px 0;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
        }

        .edit-form textarea {
            min-height: 80px;
            font-family: inherit;
        }

        /* ===== IMPORT ADH√âRENTS ===== */
        .upload-zone {
            border: 3px dashed var(--bleu-turquoise);
            background: rgba(26, 156, 158, 0.05);
            padding: 40px;
            border-radius: 15px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .upload-zone:hover {
            background: rgba(26, 156, 158, 0.1);
            border-color: var(--violet-principal);
        }

        .upload-zone input {
            display: none;
        }

        .upload-icon {
            font-size: 3em;
            color: var(--bleu-turquoise);
            margin-bottom: 15px;
        }

        /* ===== TABLEAU ===== */
        .data-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        .data-table th {
            background: var(--violet-principal);
            color: white;
            padding: 12px;
            text-align: left;
            font-weight: 600;
        }

        .data-table td {
            padding: 12px;
            border-bottom: 1px solid #e0e0e0;
        }

        .data-table tr:hover {
            background: rgba(168, 33, 122, 0.05);
        }

        /* ===== ALERTES ===== */
        .alert {
            padding: 15px 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            display: none;
        }

        .alert.success {
            background: #d4edda;
            color: #155724;
            border-left: 4px solid var(--vert);
        }

        .alert.error {
            background: #f8d7da;
            color: #721c24;
            border-left: 4px solid var(--rouge);
        }

        .alert.info {
            background: #d1ecf1;
            color: #0c5460;
            border-left: 4px solid var(--bleu-turquoise);
        }

        /* ===== RESPONSIVE ===== */
        @media (max-width: 768px) {
            .admin-header {
                flex-direction: column;
                gap: 15px;
            }

            .tabs {
                flex-direction: column;
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <!-- ===== √âCRAN DE CONNEXION ===== -->
    <div class="login-container" id="loginScreen">
        <div class="login-box">
            <h1>üîê Administration</h1>
            <p class="subtitle">Jeu Concours Alliance 2026</p>
            
            <div class="alert error" id="loginError"></div>
            
            <form id="loginForm">
                <div class="form-group">
                    <label for="username">Identifiant</label>
                    <input type="text" id="username" required autocomplete="username">
                </div>
                
                <div class="form-group">
                    <label for="password">Mot de passe</label>
                    <input type="password" id="password" required autocomplete="current-password">
                </div>
                
                <button type="submit" class="btn btn-primary">Se connecter</button>
            </form>
            
            <p style="margin-top: 20px; text-align: center; color: #999; font-size: 0.85em;">
                Identifiants par d√©faut : admin / Alliance2026!
            </p>
        </div>
    </div>

    <!-- ===== DASHBOARD ADMIN ===== -->
    <div class="admin-container" id="adminDashboard">
        <!-- Header -->
        <div class="admin-header">
            <div>
                <h1>üéÆ Tableau de bord - Jeu Concours 2026</h1>
                <p style="opacity: 0.9; margin-top: 5px;">Bienvenue, <span id="adminName">Administrateur</span></p>
            </div>
            <button class="btn-logout" onclick="logout()">üö™ D√©connexion</button>
        </div>

        <!-- Statistiques -->
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-label">Adh√©rents dans la base</div>
                <div class="stat-number" id="statAdherents">0</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">Participants au jeu</div>
                <div class="stat-number" id="statParticipants">0</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">Questions actives</div>
                <div class="stat-number" id="statQuestions">13</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">Taux de participation</div>
                <div class="stat-number" id="statTaux">0%</div>
            </div>
        </div>

        <!-- Alertes -->
        <div class="alert" id="adminAlert"></div>

        <!-- Onglets -->
        <div class="tabs">
            <button class="tab active" onclick="switchTab('questions')">üìù Gestion des questions</button>
            <button class="tab" onclick="switchTab('adherents')">üë• Base adh√©rents</button>
            <button class="tab" onclick="switchTab('participants')">üéØ Participants</button>
            <button class="tab" onclick="switchTab('settings')">‚öôÔ∏è Param√®tres</button>
        </div>

        <!-- Contenu Questions -->
        <div class="tab-content active" id="tabQuestions">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                <h2>Questions du quiz</h2>
                <button class="btn btn-primary" onclick="addNewQuestion()">‚ûï Ajouter une question</button>
            </div>
            
            <div id="questionsList"></div>
        </div>

        <!-- Contenu Adh√©rents -->
        <div class="tab-content" id="tabAdherents">
            <h2>Gestion de la base adh√©rents</h2>
            
            <div class="upload-zone" onclick="document.getElementById('excelFile').click()">
                <div class="upload-icon">üìÅ</div>
                <h3>Importer le fichier Excel des adh√©rents</h3>
                <p style="color: #666; margin-top: 10px;">
                    Cliquez ici ou glissez-d√©posez votre fichier .xlsx<br>
                    <small>(Format attendu : fusion_sans_doublons_XX_mois_XXXX.xlsx)</small>
                </p>
                <input type="file" id="excelFile" accept=".xlsx,.xls" onchange="handleExcelUpload(event)">
            </div>

            <div style="margin-top: 30px;">
                <h3>Adh√©rents enregistr√©s : <span id="adherentCount">0</span></h3>
                <div id="adherentsList" style="margin-top: 15px; max-height: 400px; overflow-y: auto;"></div>
            </div>
        </div>

        <!-- Contenu Participants -->
        <div class="tab-content" id="tabParticipants">
            <h2>Liste des participants</h2>
            
            <div style="margin: 20px 0;">
                <button class="btn btn-success" onclick="exportParticipants()">üì• Exporter en CSV</button>
                <button class="btn btn-danger" onclick="clearAllParticipants()" style="margin-left: 10px;">üóëÔ∏è R√©initialiser</button>
            </div>

            <table class="data-table" id="participantsTable">
                <thead>
                    <tr>
                        <th>Date</th>
                        <th>Nom</th>
                        <th>Pr√©nom</th>
                        <th>Email</th>
                        <th>N¬∞ Adh√©rent</th>
                        <th>Score</th>
                        <th>N¬∞ Tirage</th>
                    </tr>
                </thead>
                <tbody id="participantsBody"></tbody>
            </table>
        </div>

        <!-- Contenu Param√®tres -->
        <div class="tab-content" id="tabSettings">
            <h2>Param√®tres du jeu concours</h2>
            
            <div class="edit-form">
                <h3>Dates du concours</h3>
                <div class="form-group">
                    <label>Date de d√©but</label>
                    <input type="date" id="settingStartDate" value="2026-02-15">
                </div>
                <div class="form-group">
                    <label>Date de fin</label>
                    <input type="date" id="settingEndDate" value="2026-03-15">
                </div>

                <h3 style="margin-top: 30px;">S√©curit√©</h3>
                <div class="form-group">
                    <label>Nouveau mot de passe administrateur</label>
                    <input type="password" id="settingNewPassword" placeholder="Laisser vide pour ne pas changer">
                </div>

                <button class="btn btn-primary" onclick="saveSettings()">üíæ Enregistrer les param√®tres</button>
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script>
        // ===== CONFIGURATION =====
        const ADMIN_CREDENTIALS = {
            username: 'admin',
            password: 'Alliance2026!' // √Ä changer apr√®s premi√®re connexion
        };

        // ===== DONN√âES DU QUIZ =====
        let quizQuestions = [
            {
                id: 1,
                question: "En quelle ann√©e a √©t√© sign√© le premier accord √©lectoral pour cr√©er l'Alliance CFE-UNSA √ânergies ?",
                options: ["2008", "2009", "2010", "2012"],
                correctAnswer: 1 // Index de la bonne r√©ponse (B = index 1)
            },
            {
                id: 2,
                question: "Quel est l'objectif principal de l'Alliance ?",
                options: [
                    "Augmenter le nombre de si√®ges au CSE uniquement",
                    "Fusionner tous les syndicats",
                    "√ätre plus influent pour mieux d√©fendre les adh√©rents",
                    "Supprimer les autres organisations syndicales"
                ],
                correctAnswer: 2
            },
            {
                id: 3,
                question: "√ätre repr√©sentatif signifie :",
                options: [
                    "Avoir le plus grand nombre d'adh√©rents",
                    "√ätre reconnu comme porte-parole des salari√©s dans les n√©gociations",
                    "Avoir au moins un √©lu au CSE",
                    "√ätre pr√©sent dans les trois coll√®ges"
                ],
                correctAnswer: 1
            },
            {
                id: 4,
                question: "Quel est le seuil minimal d'audience pour √™tre repr√©sentatif dans les entreprises ?",
                options: ["5 %", "8 %", "10 %", "15 %"],
                correctAnswer: 2
            },
            {
                id: 5,
                question: "√ätre repr√©sentatif permet de :",
                options: [
                    "D√©signer un D√©l√©gu√© Syndical",
                    "Modifier le nombre de si√®ges au CSE",
                    "Supprimer les autres syndicats",
                    "Doubler automatiquement les √©lus"
                ],
                correctAnswer: 0
            },
            {
                id: 6,
                question: "Dans une entreprise de 1000 salari√©s, combien de voix faut-il pour atteindre 10 % ?",
                options: ["50", "75", "100", "150"],
                correctAnswer: 2
            },
            {
                id: 7,
                question: "La repr√©sentativit√© est donn√©e :",
                options: [
                    "√Ä une liste √©lectorale",
                    "√Ä un candidat",
                    "√Ä un syndicat",
                    "Au coll√®ge majoritaire"
                ],
                correctAnswer: 2
            },
            {
                id: 8,
                question: "Qu'est-ce qu'une cl√© de r√©partition ?",
                options: [
                    "Une r√®gle pour r√©partir les si√®ges",
                    "Une r√®gle pour r√©partir les voix d'une liste d'entente",
                    "Un mode de calcul des adh√©sions",
                    "Un accord sur la d√©signation des √©lus"
                ],
                correctAnswer: 1
            },
            {
                id: 9,
                question: "Quelle est la cl√© par d√©faut dans une liste d'entente ?",
                options: ["60 / 40", "70 / 30", "100 / 0", "50 / 50"],
                correctAnswer: 3
            },
            {
                id: 10,
                question: "Modifier la cl√© de r√©partition a un impact sur :",
                options: [
                    "Le nombre d'√©lus",
                    "Le nombre de si√®ges au CSE",
                    "L'audience et la repr√©sentativit√©",
                    "Le nombre total de votants"
                ],
                correctAnswer: 2
            },
            {
                id: 11,
                question: "Si la CFE d√©passe 50 %, elle peut signer seule un accord ?",
                options: [
                    "Oui, automatiquement",
                    "Oui, si elle a le plus d'√©lus",
                    "Non, car elle est cat√©gorielle",
                    "Oui, uniquement dans le coll√®ge cadre"
                ],
                correctAnswer: 2
            },
            {
                id: 12,
                question: "Donner des voix √† l'UNSA peut :",
                options: [
                    "Augmenter la repr√©sentativit√© globale de l'Alliance",
                    "Supprimer des si√®ges au CSE",
                    "Annuler les √©lections",
                    "Emp√™cher toute signature d'accord"
                ],
                correctAnswer: 0
            },
            {
                id: 13,
                question: "Quel est le slogan de l'Alliance CFE-UNSA √ânergies ?",
                options: [
                    "Unir, Prot√©ger, Avancer",
                    "√âclairer, Prot√©ger, Avancer",
                    "D√©fendre, Informer, Progresser",
                    "Ensemble, Plus Forts, Plus Justes"
                ],
                correctAnswer: 1
            }
        ];

        // ===== INITIALISATION =====
        document.addEventListener('DOMContentLoaded', function() {
            // Charger les donn√©es depuis localStorage
            loadQuestions();
            loadAdherents();
            loadParticipants();
            updateStats();
        });

        // ===== AUTHENTIFICATION =====
        document.getElementById('loginForm').addEventListener('submit', function(e) {
            e.preventDefault();
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            
            // V√©rifier les credentials (en production, utiliser un backend s√©curis√©)
            const savedPassword = localStorage.getItem('adminPassword') || ADMIN_CREDENTIALS.password;
            
            if (username === ADMIN_CREDENTIALS.username && password === savedPassword) {
                document.getElementById('loginScreen').style.display = 'none';
                document.getElementById('adminDashboard').style.display = 'block';
                document.getElementById('adminName').textContent = username;
                loadQuestionsList();
            } else {
                showLoginError('Identifiants incorrects');
            }
        });

        function logout() {
            document.getElementById('loginScreen').style.display = 'flex';
            document.getElementById('adminDashboard').style.display = 'none';
            document.getElementById('username').value = '';
            document.getElementById('password').value = '';
        }

        function showLoginError(message) {
            const errorDiv = document.getElementById('loginError');
            errorDiv.textContent = message;
            errorDiv.style.display = 'block';
            setTimeout(() => {
                errorDiv.style.display = 'none';
            }, 3000);
        }

        // ===== GESTION DES ONGLETS =====
        function switchTab(tabName) {
            // D√©sactiver tous les onglets
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            
            // Activer l'onglet cliqu√©
            event.target.classList.add('active');
            document.getElementById('tab' + tabName.charAt(0).toUpperCase() + tabName.slice(1)).classList.add('active');
            
            // Charger les donn√©es sp√©cifiques
            if (tabName === 'participants') {
                loadParticipantsList();
            } else if (tabName === 'adherents') {
                displayAdherents();
            }
        }

        // ===== GESTION DES QUESTIONS =====
        function loadQuestions() {
            const saved = localStorage.getItem('quizQuestions');
            if (saved) {
                quizQuestions = JSON.parse(saved);
            }
        }

        function saveQuestions() {
            localStorage.setItem('quizQuestions', JSON.stringify(quizQuestions));
            showAlert('Questions sauvegard√©es avec succ√®s', 'success');
        }

        function loadQuestionsList() {
            const container = document.getElementById('questionsList');
            container.innerHTML = '';
            
            quizQuestions.forEach((q, index) => {
                const questionDiv = document.createElement('div');
                questionDiv.className = 'question-item';
                questionDiv.innerHTML = `
                    <div class="question-header">
                        <span class="question-number">Question ${q.id}</span>
                        <div class="question-actions">
                            <button class="btn-small btn-primary" onclick="editQuestion(${index})">‚úèÔ∏è Modifier</button>
                            <button class="btn-small btn-danger" onclick="deleteQuestion(${index})">üóëÔ∏è Supprimer</button>
                        </div>
                    </div>
                    <div style="font-weight: 500; margin-bottom: 10px;">${q.question}</div>
                    ${q.options.map((opt, i) => `
                        <div class="answer-option ${i === q.correctAnswer ? 'correct' : ''}">
                            <strong>${String.fromCharCode(65 + i)})</strong> ${opt}
                            ${i === q.correctAnswer ? '‚úÖ' : ''}
                        </div>
                    `).join('')}
                `;
                container.appendChild(questionDiv);
            });
        }

        function editQuestion(index) {
            const q = quizQuestions[index];
            const newQuestion = prompt('Modifier la question:', q.question);
            if (newQuestion) {
                quizQuestions[index].question = newQuestion;
                
                // Modifier les options
                for (let i = 0; i < 4; i++) {
                    const newOption = prompt(`Option ${String.fromCharCode(65 + i)}:`, q.options[i]);
                    if (newOption) {
                        quizQuestions[index].options[i] = newOption;
                    }
                }
                
                const correctIndex = prompt('Index de la bonne r√©ponse (0-3):', q.correctAnswer);
                if (correctIndex !== null) {
                    quizQuestions[index].correctAnswer = parseInt(correctIndex);
                }
                
                saveQuestions();
                loadQuestionsList();
            }
        }

        function deleteQuestion(index) {
            if (confirm('√ätes-vous s√ªr de vouloir supprimer cette question ?')) {
                quizQuestions.splice(index, 1);
                // R√©organiser les IDs
                quizQuestions.forEach((q, i) => q.id = i + 1);
                saveQuestions();
                loadQuestionsList();
                updateStats();
            }
        }

        function addNewQuestion() {
            const question = prompt('Entrez la nouvelle question:');
            if (!question) return;
            
            const options = [];
            for (let i = 0; i < 4; i++) {
                const opt = prompt(`Option ${String.fromCharCode(65 + i)}:`);
                if (!opt) return;
                options.push(opt);
            }
            
            const correctAnswer = prompt('Index de la bonne r√©ponse (0-3):');
            if (correctAnswer === null) return;
            
            quizQuestions.push({
                id: quizQuestions.length + 1,
                question: question,
                options: options,
                correctAnswer: parseInt(correctAnswer)
            });
            
            saveQuestions();
            loadQuestionsList();
            updateStats();
        }

        // ===== GESTION DES ADH√âRENTS =====
        function handleExcelUpload(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const data = new Uint8Array(e.target.result);
                    const workbook = XLSX.read(data, { type: 'array' });
                    const firstSheet = workbook.Sheets[workbook.SheetNames[0]];
                    const jsonData = XLSX.utils.sheet_to_json(firstSheet, { header: 1 });
                    
                    // Traiter les donn√©es (ligne 0 = titre, ligne 1 = syndicat, ligne 2 vide, ligne 3 = headers)
                    const headers = jsonData[3];
                    const adherents = [];
                    
                    for (let i = 5; i < jsonData.length; i++) { // Commencer √† ligne 5 (apr√®s header et ligne vide)
                        const row = jsonData[i];
                        if (row && row.length > 0 && row[0]) { // V√©rifier que la ligne n'est pas vide
                            adherents.push({
                                nom: row[0] || '',
                                prenom: row[1] || '',
                                email: row[34] || '', // Colonne E-mail
                                syndicat: row[31] || '', // Colonne Syndicat
                                adhesion: row[32] || '' // Colonne Date Adh√©sion
                            });
                        }
                    }
                    
                    // Filtrer les adh√©rents valides (avec nom et pr√©nom au minimum)
                    const validAdherents = adherents.filter(a => a.nom && a.prenom);
                    
                    // Sauvegarder dans localStorage
                    localStorage.setItem('adherentsDB', JSON.stringify(validAdherents));
                    
                    showAlert(`${validAdherents.length} adh√©rents import√©s avec succ√®s !`, 'success');
                    updateStats();
                    displayAdherents();
                    
                } catch (error) {
                    console.error('Erreur lors de l\'import:', error);
                    showAlert('Erreur lors de l\'import du fichier Excel', 'error');
                }
            };
            reader.readAsArrayBuffer(file);
        }

        function loadAdherents() {
            return JSON.parse(localStorage.getItem('adherentsDB') || '[]');
        }

        function displayAdherents() {
            const adherents = loadAdherents();
            const container = document.getElementById('adherentsList');
            document.getElementById('adherentCount').textContent = adherents.length;
            
            if (adherents.length === 0) {
                container.innerHTML = '<p style="color: #999;">Aucun adh√©rent dans la base. Importez le fichier Excel.</p>';
                return;
            }
            
            let html = '<table class="data-table"><thead><tr><th>Nom</th><th>Pr√©nom</th><th>Email</th><th>Syndicat</th></tr></thead><tbody>';
            adherents.slice(0, 50).forEach(a => {
                html += `<tr><td>${a.nom}</td><td>${a.prenom}</td><td>${a.email || 'N/A'}</td><td>${a.syndicat}</td></tr>`;
            });
            html += '</tbody></table>';
            
            if (adherents.length > 50) {
                html += `<p style="margin-top: 10px; color: #666;">Affichage limit√© aux 50 premiers. Total : ${adherents.length} adh√©rents.</p>`;
            }
            
            container.innerHTML = html;
        }

        // ===== GESTION DES PARTICIPANTS =====
        function loadParticipants() {
            return JSON.parse(localStorage.getItem('concoursPart icipants') || '[]');
        }

        function loadParticipantsList() {
            const participants = loadParticipants();
            const tbody = document.getElementById('participantsBody');
            
            if (participants.length === 0) {
                tbody.innerHTML = '<tr><td colspan="7" style="text-align:center;color:#999;">Aucune participation pour le moment</td></tr>';
                return;
            }
            
            tbody.innerHTML = participants.map(p => `
                <tr>
                    <td>${new Date(p.date).toLocaleDateString('fr-FR')}</td>
                    <td>${p.nom}</td>
                    <td>${p.prenom}</td>
                    <td>${p.email}</td>
                    <td>${p.numeroAdherent || 'N/A'}</td>
                    <td>${p.score}/13 (${p.scorePercent}%)</td>
                    <td><strong>${p.lotteryNumber}</strong></td>
                </tr>
            `).join('');
        }

        function exportParticipants() {
            const participants = loadParticipants();
            if (participants.length === 0) {
                alert('Aucune participation √† exporter');
                return;
            }
            
            let csv = 'Date,Nom,Pr√©nom,Email,N¬∞ Adh√©rent,Score,Pourcentage,N¬∞ Tirage\n';
            participants.forEach(p => {
                csv += `${new Date(p.date).toLocaleDateString('fr-FR')},${p.nom},${p.prenom},${p.email},${p.numeroAdherent || ''},${p.score},${p.scorePercent}%,${p.lotteryNumber}\n`;
            });
            
            const blob = new Blob([csv], { type: 'text/csv' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `participants_concours_${new Date().toISOString().split('T')[0]}.csv`;
            a.click();
        }

        function clearAllParticipants() {
            if (confirm('‚ö†Ô∏è ATTENTION : Cette action supprimera TOUTES les participations. Continuer ?')) {
                localStorage.removeItem('concoursParticipants');
                localStorage.setItem('participantsCount', '0');
                showAlert('Toutes les participations ont √©t√© supprim√©es', 'success');
                loadParticipantsList();
                updateStats();
            }
        }

        // ===== PARAM√àTRES =====
        function saveSettings() {
            const newPassword = document.getElementById('settingNewPassword').value;
            if (newPassword) {
                localStorage.setItem('adminPassword', newPassword);
                document.getElementById('settingNewPassword').value = '';
                showAlert('Mot de passe administrateur mis √† jour', 'success');
            } else {
                showAlert('Param√®tres sauvegard√©s', 'success');
            }
        }

        // ===== STATISTIQUES =====
        function updateStats() {
            const adherents = loadAdherents();
            const participants = loadParticipants();
            
            document.getElementById('statAdherents').textContent = adherents.length;
            document.getElementById('statParticipants').textContent = participants.length;
            document.getElementById('statQuestions').textContent = quizQuestions.length;
            
            const taux = adherents.length > 0 ? Math.round((participants.length / adherents.length) * 100) : 0;
            document.getElementById('statTaux').textContent = taux + '%';
        }

        // ===== ALERTES =====
        function showAlert(message, type) {
            const alert = document.getElementById('adminAlert');
            alert.className = `alert ${type}`;
            alert.textContent = message;
            alert.style.display = 'block';
            
            setTimeout(() => {
                alert.style.display = 'none';
            }, 5000);
        }

        // ===== EXPORT DES QUESTIONS POUR LE JEU =====
        function exportQuestionsForGame() {
            // Cette fonction permet d'exporter les questions au format JavaScript
            // pour les copier dans le fichier du jeu
            const jsCode = `const quizQuestions = ${JSON.stringify(quizQuestions, null, 2)};`;
            console.log('üìã Copiez ce code dans le jeu concours:');
            console.log(jsCode);
            
            // Copier dans le presse-papiers
            navigator.clipboard.writeText(jsCode);
            showAlert('Code JavaScript copi√© dans le presse-papiers !', 'success');
        }
    </script>
</body>
</html>